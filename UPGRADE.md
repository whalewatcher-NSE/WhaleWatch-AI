# WhaleWatch-AI v2 — Upgrade Instructions

## What Changed

### fetch_data.py (288 → 363 lines)
1. **F&O stock filter** — Fetches live F&O list from NSE API (`SECURITIES IN F&O` index), caches to `data/fno_stocks.json`, refreshed daily
2. **Bulk deals APPEND** — No longer overwrites `bulk_deals.csv` each run. Deduplicates by date, keeps 90 days of history
3. **Investor classification** — Curated keyword lists for FII custodians, DII fund houses, and prop/algo desks (JUNOMONETA, NK SECURITIES, etc. correctly tagged as Prop/Algo instead of "Other")
4. **Actionable alerts** — Generates `data/alerts_today.json` with F&O-only institutional deals for next-morning put selling decisions

### app.py (397 → 361 lines)
1. **New "F&O Bulk Deals" tab** — Separate tab showing ONLY F&O-eligible stocks from bulk/block deals
2. **Alerts panel** — Shows today's F&O institutional alerts at top of dashboard
3. **F&O badge** — Whale Radar table now shows which stocks are F&O eligible
4. **Sidebar toggle** — "F&O stocks only" checkbox to filter everything
5. **Stock Lookup** — Now shows F&O eligibility status
6. **Better investor filter** — 5 categories instead of 3 (FII, DII, Prop/Algo, Promoter/HNI, Other)

### New files
- `data/fno_stocks.json` — Cached F&O stock list (auto-refreshed daily)
- `data/alerts_today.json` — Today's actionable alerts (generated by fetch_data.py)

## How to Deploy

### Option 1: Direct file replace
```bash
cd WhaleWatch-AI

# Replace the two main files
cp /path/to/downloaded/fetch_data.py ./fetch_data.py
cp /path/to/downloaded/app.py ./app.py

# Copy the F&O list (or let it auto-generate on first run)
cp /path/to/downloaded/fno_stocks.json ./data/fno_stocks.json

# Commit and push
git add -A
git commit -m "v2: F&O filter, bulk deal append, investor classification, alerts"
git push origin main
```

### Option 2: Test locally first
```bash
# Test fetch
python fetch_data.py

# Test dashboard
streamlit run app.py
```

## No changes needed to:
- `.github/workflows/scrape.yml` (same entry point)
- `requirements.txt` (no new dependencies — uses stdlib `json`)
- `analyze_strategy.py` (separate concern)
- `data/daily/` or `data/history/` (untouched)
